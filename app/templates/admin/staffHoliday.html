{% load static %}

<style>
/* 별도 스크롤 영역을 만들지 않고 상위 컨테이너 스크롤을 그대로 사용 */
.staff-holiday-wrap {
    padding: 20px;
}
</style>

<div class="staff-holiday-wrap">
    <!-- ROW OPEN -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Calendar With different Color Events</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12 col-xl-3">
                            <div id="external-events">
                                <h4>Draggable Events</h4>
                                <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event bg-primary sample-event">
                                    <div class="fc-event-main">Sample Event 1</div>
                                </div>
                                <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event bg-secondary sample-event" data-class="bg-teal">
                                    <div class="fc-event-main">Sample Event 2</div>
                                </div>
                                <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event bg-teritary sample-event" data-class="bg-warning">
                                    <div class="fc-event-main">Sample Event 3</div>
                                </div>
                                <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event bg-custom-yellow sample-event" data-class=" bg-info">
                                    <div class="fc-event-main">Sample Event 4</div>
                                </div>
                                <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event bg-orange sample-event" data-class="bg-danger">
                                    <div class="fc-event-main">Sample Event 5</div>
                                </div>
                            </div>

                            <div id="custom-events" class="mt-6">
                                <form>
                                    <h4>Custom Event</h4>
                                    <label class="mt-3">Event Title:</label>
                                    <div class="mg-b-30 mb-3">
                                        <div class="input-group">
                                            <input class="form-control" placeholder="your title here..." type="text">
                                        </div>
                                    </div>
                                    <label>Event Date:</label>
                                    <div class="mg-b-30 mb-3">
                                        <div class="input-group">
                                            <div id="datePickerStyle1" class="input-group date" data-date-format="mm-dd-yyyy">
                                                <span class="input-group-addon input-group-text bg-primary-transparent"><i class="fe fe-calendar text-primary-dark"></i></span>
                                                <input class="form-control" id="bootstrapDatePicker" type="text" placeholder="DD/MM/YYYY"/>
                                            </div>
                                        </div>
                                    </div>
                                    <label>Event Type:</label>
                                    <div class="mg-b-30 mb-3">
                                        <div class="form-group">
                                            <select class="form-control select2-show-search form-select select2-hidden-accessible" data-placeholder="Choose Type..." tabindex="-1" aria-hidden="true">
                                                <option label="Choose one"></option>
                                                <option value="day">Birthday</option>
                                                <option value="day">Anniversary</option>
                                                <option value="day">Wedding Day</option>
                                                <option value="day">Others</option>
                                            </select>
                                        </div>
                                    </div>
                                    <label>Reminder:</label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mg-b-30 mb-3">
                                                <div class="form-group">
                                                    <select class="form-control select2-show-search form-select select2-hidden-accessible" data-placeholder="Choose one" tabindex="-1" aria-hidden="true">
                                                        <option label="Choose one"></option>
                                                        <option value="day">1 day before</option>
                                                        <option value="day">3 days before</option>
                                                        <option value="day">5 days before</option>
                                                        <option value="day">1 week before</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <input class="form-control" id="tp3" placeholder="Set time" type="text">
                                        </div>
                                    </div>
                                    <div class="wd-150 mg-b-30 ce-btn-group my-1">
                                        <button class="btn btn-primary ce-add">ADD</button>
                                        <button class="btn btn-secondary ce-reset">RESET</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="col-md-12 col-xl-9">
                            <div id='calendar2'></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ROW CLOSED -->
</div>

<!-- SELECT2 JS -->
<script src="{% static 'assets/plugins/select2/select2.full.min.js' %}"></script>

<!-- bootstrap-datepicker js -->
<script src="{% static 'assets/plugins/bootstrap-datepicker/js/datepicker.js' %}"></script>

<!-- TIMEPICKER JS -->
<script src="{% static 'assets/plugins/time-picker/jquery.timepicker.js' %}"></script>
<script src="{% static 'assets/plugins/time-picker/toggles.min.js' %}"></script>

<!-- FULL CALENDAR JS -->
<script src="{% static 'assets/plugins/fullcalendar/moment.min.js' %}"></script>
<script src="{% static 'assets/plugins/fullcalendar/fullcalendar.min.js' %}"></script>
<script src="{% static 'assets/js/fullcalendar.js' %}"></script>

<script>
// AJAX 탭 로드 후에도 바로 캘린더를 초기화하도록 자체 실행
(function() {
    if (!window.FullCalendar) return;

    const calendarEl = document.getElementById('calendar2');
    const externalEl = document.getElementById('external-events');

    // 이미 초기화됐다면 중복 렌더 방지
    if (!calendarEl || calendarEl.dataset.fcInited === '1') return;

    if (externalEl && FullCalendar.Draggable) {
        new FullCalendar.Draggable(externalEl, {
            itemSelector: '.fc-event',
            eventData: function(eventEl) {
                return {
                    title: eventEl.innerText.trim(),
                    className: eventEl.className + ' overflow-hidden '
                };
            }
        });
    }

    const calendar = new FullCalendar.Calendar(calendarEl, {
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
        },
        initialView: 'dayGridMonth',
        navLinks: true,
        businessHours: true,
        editable: true,
        selectable: true,
        selectMirror: true,
        droppable: true,
        select: function(arg) {
            const title = prompt('Event Title:');
            if (title) {
                calendar.addEvent({
                    title: title,
                    start: arg.start,
                    end: arg.end,
                    allDay: arg.allDay
                });
            }
            calendar.unselect();
        },
        eventClick: function(arg) {
            if (confirm('Are you sure you want to delete this event?')) {
                arg.event.remove();
            }
        },
        dayMaxEvents: true,
        events: [
            { title: 'Business Lunch', start: '2021-10-03T13:00:00', constraint: 'businessHours' },
            { title: 'Meeting', start: '2021-10-13T11:00:00', constraint: 'availableForMeeting', color: '#38cab3' },
            { title: 'Conference', start: '2021-10-18', end: '2021-10-20', color: '#f74f75' },
            { title: 'Party', start: '2021-11-29T20:00:00', color: '#ffbd5a' },
            { id: 'availableForMeeting', start: '2021-10-11T10:00:00', end: '2021-10-11T16:00:00', rendering: 'background', color: '#f34343' }
        ]
    });

    calendarEl.dataset.fcInited = '1';
    calendar.render();
})();
</script>
